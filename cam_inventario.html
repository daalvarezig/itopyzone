<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üì∏ Cam Inventario | iT@pyz0n-e</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle at center, #0b0f1a 0%, #000000 100%);
  color: #e8f6ff;
  text-align: center;
  padding: 40px 15px;
}
h1 {
  font-weight: 700;
  color: #00e0ff;
  text-shadow: 0 0 8px #00e0ff;
  margin-bottom: 8px;
}
#qr-reader {
  width: 340px;
  max-width: 90vw;
  margin: 20px auto;
  border-radius: 10px;
  overflow: hidden;
  display: none;
}
#btn-scan, #btn-close {
  background: linear-gradient(90deg, #007BFF, #00E0FF);
  border: none;
  border-radius: 30px;
  padding: 12px 25px;
  font-size: 1rem;
  color: white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  transition: 0.3s;
}
#btn-scan:hover, #btn-close:hover {
  transform: scale(1.05);
}
#msg {
  margin-top: 15px;
  font-size: 0.95rem;
  color: #aad8ff;
}
.btn-contacto {
  display: inline-block;
  margin: 10px;
  padding: 10px 22px;
  border-radius: 25px;
  font-weight: 600;
  color: white;
  text-decoration: none;
  transition: 0.3s;
}
.btn-telegram {
  background: linear-gradient(90deg, #0088cc, #00e0ff);
}
.btn-whatsapp {
  background: linear-gradient(90deg, #25D366, #128C7E);
}
.btn-contacto:hover {
  transform: scale(1.05);
  opacity: 0.9;
}
footer {
  font-size: 0.8rem;
  color: #5cd8ff;
  margin-top: 40px;
}
</style>
</head>

<body>
  <h1>üì¶ iT@pyz0n-e</h1>
  <h5 class="text-info mb-4">Cam Inventario ‚Äî Esc√°ner de productos</h5>

  <p id="msg">Activa la c√°mara para escanear c√≥digos de producto o busca manualmente.</p>

  <button id="btn-scan">üì∑ Activar c√°mara</button>
  <button id="btn-close" style="display:none;">‚ùå Cerrar c√°mara</button>

  <div id="qr-reader"></div>

  <div class="mt-4">
    <a href="https://t.me/iTopyzone_bot" target="_blank" class="btn-contacto btn-telegram">
      ü§ñ Bot Telegram
    </a>
    <a href="https://wa.me/34644935856?text=Hola%20David,%20vengo%20desde%20tu%20Desv√°n%20iT@pyz0n-e!" 
       target="_blank" class="btn-contacto btn-whatsapp">
      üí¨ WhatsApp
    </a>
  </div>

  <footer>
    <p>¬© 2025 iT@pyz0n-e | Desarrollado por David √Ålvarez</p>
  </footer>

  <script>
  let html5QrcodeScanner = null;

  async function checkCameraPermission() {
    try {
      const devices = await navigator.mediaDevices.enumerateDevices();
      const hasCamera = devices.some(d => d.kind === 'videoinput');
      if (!hasCamera) throw new Error("No hay c√°mara detectada.");
      return true;
    } catch (e) {
      document.getElementById("msg").innerHTML = "‚ö†Ô∏è C√°mara no disponible. Usa b√∫squeda manual o contacta abajo.";
      document.getElementById("btn-scan").disabled = true;
      return false;
    }
  }

  document.getElementById("btn-scan").addEventListener("click", async () => {
    if (!(await checkCameraPermission())) return;

    document.getElementById("qr-reader").style.display = "block";
    document.getElementById("btn-scan").style.display = "none";
    document.getElementById("btn-close").style.display = "inline-block";
    document.getElementById("msg").innerHTML = "üì∏ Apunta al c√≥digo de barras o QR del producto...";

    html5QrcodeScanner = new Html5Qrcode("qr-reader");
    html5QrcodeScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      (decodedText) => {
        alert("‚úÖ C√≥digo detectado: " + decodedText);
        window.location.href = `https://daalvarezig.github.io/itopyzone/?search=${encodeURIComponent(decodedText)}`;
        stopScanner();
      },
      (errorMessage) => { console.warn("Lectura fallida:", errorMessage); }
    );
  });

  function stopScanner() {
    if (html5QrcodeScanner) {
      html5QrcodeScanner.stop().then(() => {
        html5QrcodeScanner.clear();
        document.getElementById("qr-reader").style.display = "none";
        document.getElementById("btn-scan").style.display = "inline-block";
        document.getElementById("btn-close").style.display = "none";
        document.getElementById("msg").innerHTML = "üì¶ Escanea otro producto o usa el buscador manual.";
      }).catch(e => console.error("Error al detener c√°mara:", e));
    }
  }

  document.getElementById("btn-close").addEventListener("click", stopScanner);
  </script>
</body>
</html>
